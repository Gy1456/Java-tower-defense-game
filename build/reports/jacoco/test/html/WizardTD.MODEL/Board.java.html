<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="zh"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Board.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">scaffold</a> &gt; <a href="index.source.html" class="el_package">WizardTD.MODEL</a> &gt; <span class="el_source">Board.java</span></div><h1>Board.java</h1><pre class="source lang-java linenums">package WizardTD.MODEL;
import WizardTD.App;
import WizardTD.Gamebase.GameSet;
import WizardTD.Wavemanage.Wavemangement;
import org.checkerframework.checker.units.qual.A;

import javax.sound.sampled.Clip;
import java.util.ArrayList;
import java.util.HashMap;
public class Board {
    /**
     * A two-dimensional grid representing the game map.
     */
    char[][] map;

    /**
     * The initial firing speed of towers.
     */
    private double initial_tower_firing_speed;

    /**
     * The initial range of towers.
     */
    private double initial_tower_range;

    /**
     * The initial damage dealt by towers.
     */
    private double initial_tower_damage;

    /**
     * The cost of building towers.
     */
    private double tower_cost;

    /**
     * A list of grass tiles on the game board.
     */
    private ArrayList&lt;Grass&gt; grass;

    /**
     * A list of path tiles on the game board.
     */
    private ArrayList&lt;Path&gt; path;

    /**
     * A list of shrub objects on the game board.
     */
    private ArrayList&lt;Shrub&gt; shrubs;

    /**
     * A list of tower objects on the game board.
     */
    private ArrayList&lt;Tower&gt; towers;

    /**
     * A list of selected tower objects.
     */
    private ArrayList&lt;Tower&gt; selectedTowers;

    /**
     * The wizard character in the game.
     */
    private Wizard wizard;

    /**
     * The mana resource for the game.
     */
    private Mana mana;

    /**
     * The game set configuration.
     */
    private GameSet set;

    /**
     * The wave management system.
     */
    private Wavemangement wavemangement;

    /**
     * A boolean flag indicating whether tower building is enabled.
     */
    private boolean buidenable;

    /**
     * A boolean flag indicating whether tower speed level up is enabled.
     */
    private boolean speedlevelupenable;

    /**
     * A boolean flag indicating whether tower range level up is enabled.
     */
    private boolean rangelevelupenable;

    /**
     * A boolean flag indicating whether tower damage level up is enabled.
     */
    private boolean damagelevelupenable;

    /**
     * A collection of sound clips used in the game.
     */
    private HashMap&lt;String, Clip&gt; sound;
    /**
     * Constructs a game board with the provided configuration.
     *
     * @param map The 2D grid representing the game map.
     * @param mana The mana resource for the game.
     * @param initial_tower_firing_speed The initial firing speed of towers.
     * @param initial_tower_range The initial range of towers.
     * @param initial_tower_damage The initial damage dealt by towers.
     * @param tower_cost The cost of building towers.
     * @param wavemangement The wave management system.
     * @param set The game set configuration.
     * @param sound A collection of sound clips used in the game.
     */
    public Board(char[][] map, Mana mana, double initial_tower_firing_speed, double initial_tower_range,
<span class="fc" id="L119">                 double initial_tower_damage, double tower_cost,Wavemangement wavemangement,GameSet set,HashMap&lt;String, Clip&gt; sound){</span>
<span class="fc" id="L120">        this.map=map;</span>
<span class="fc" id="L121">        this.mana=mana;</span>
<span class="fc" id="L122">        this.wavemangement=wavemangement;</span>
<span class="fc" id="L123">        this.initial_tower_firing_speed=initial_tower_firing_speed;</span>
<span class="fc" id="L124">        this.initial_tower_range=initial_tower_range;</span>
<span class="fc" id="L125">        this.initial_tower_damage=initial_tower_damage;</span>
<span class="fc" id="L126">        this.tower_cost=tower_cost;</span>
<span class="fc" id="L127">        this.grass=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L128">        this.path=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L129">        this.shrubs=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L130">        this.towers=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L131">        this.buidenable=false;</span>
<span class="fc" id="L132">        this.set=set;</span>
<span class="fc" id="L133">        this.speedlevelupenable=false;</span>
<span class="fc" id="L134">        this.rangelevelupenable=false;</span>
<span class="fc" id="L135">        this.damagelevelupenable=false;</span>
<span class="fc" id="L136">        this.selectedTowers=new ArrayList&lt;&gt;();</span>
<span class="fc" id="L137">        this.sound=sound;</span>
<span class="fc" id="L138">    }</span>
    /**
     * Determines the type of path under the specified coordinate in a 2D grid.
     * @param path The 2D grid of characters representing the path.
     * @param i The row index of the coordinate.
     * @param j The column index of the coordinate.
     * @return A string representing the type of path, such as &quot;path0&quot; or &quot;path1_clockwise_90&quot;.
     */
    public String pathtype(char[][] path,int i,int j) {
<span class="pc bpc" id="L147" title="1 of 4 branches missed.">        if(i==0||i==19){</span>
<span class="fc" id="L148">            return(&quot;path0_clockwise_90&quot;);</span>
        }
<span class="pc bpc" id="L150" title="1 of 4 branches missed.">        else if(j==0||j==19){</span>
<span class="fc" id="L151">            return(&quot;path0&quot;);</span>
        }
<span class="fc bfc" id="L153" title="All 8 branches covered.">        else if((path[i+1][j]=='X'||path[i-1][j]=='X')&amp;&amp;(path[i][j+1]!='X'&amp;&amp;path[i][j-1]!='X')){</span>
<span class="fc" id="L154">            return(&quot;path0_clockwise_90&quot;);</span>
        }
<span class="pc bpc" id="L156" title="3 of 8 branches missed.">        else if((path[i+1][j]!='X'&amp;&amp;path[i-1][j]!='X')&amp;&amp;(path[i][j+1]=='X'||path[i][j-1]=='X')){</span>
<span class="fc" id="L157">            return(&quot;path0&quot;);</span>
        }
<span class="pc bpc" id="L159" title="1 of 8 branches missed.">        else if((path[i+1][j]=='X'&amp;&amp;path[i][j+1]=='X')&amp;&amp;(path[i-1][j]!='X'&amp;&amp;path[i][j-1]!='X')){</span>
<span class="fc" id="L160">            return (&quot;path1_clockwise_-90&quot;);</span>
        }
<span class="pc bpc" id="L162" title="2 of 8 branches missed.">        else if((path[i+1][j]=='X'&amp;&amp;path[i][j-1]=='X')&amp;&amp;(path[i-1][j]!='X'&amp;&amp;path[i][j+1]!='X')){</span>
<span class="fc" id="L163">            return(&quot;path1&quot;);</span>
        }
<span class="pc bpc" id="L165" title="2 of 8 branches missed.">        else if((path[i-1][j]=='X'&amp;&amp;path[i][j+1]=='X')&amp;&amp;(path[i+1][j]!='X'&amp;&amp;path[i][j-1]!='X')){</span>
<span class="nc" id="L166">            return(&quot;path1_clockwise_180&quot;);</span>
        }
<span class="pc bpc" id="L168" title="2 of 8 branches missed.">        else if((path[i-1][j]=='X'&amp;&amp;path[i][j-1]=='X')&amp;&amp;(path[i+1][j]!='X'&amp;&amp;path[i][j+1]!='X')){</span>
<span class="fc" id="L169">            return(&quot;path1_clockwise_90&quot;);</span>
        }
<span class="pc bpc" id="L171" title="2 of 8 branches missed.">        else if((path[i-1][j]=='X'&amp;&amp;path[i+1][j]=='X')&amp;&amp;path[i][j+1]=='X'&amp;&amp;path[i][j-1]!='X'){</span>
<span class="nc" id="L172">            return(&quot;path2_clockwise_-90&quot;);</span>
        }
<span class="pc bpc" id="L174" title="2 of 8 branches missed.">        else if((path[i-1][j]=='X'&amp;&amp;path[i+1][j]=='X')&amp;&amp;path[i][j-1]=='X'&amp;&amp;path[i][j+1]!='X'){</span>
<span class="fc" id="L175">            return(&quot;path2_clockwise_90&quot;);</span>
        }
<span class="pc bpc" id="L177" title="3 of 8 branches missed.">        else if((path[i][j-1]=='X'&amp;&amp;path[i][j+1]=='X')&amp;&amp;path[i+1][j]=='X'&amp;&amp;path[i-1][j]!='X'){</span>
<span class="nc" id="L178">            return(&quot;path2&quot;);</span>
        }
<span class="pc bpc" id="L180" title="3 of 8 branches missed.">        else if((path[i][j-1]=='X'&amp;&amp;path[i][j+1]=='X')&amp;&amp;path[i-1][j]=='X'&amp;&amp;path[i+1][j]!='X'){</span>
<span class="fc" id="L181">            return(&quot;path2_clockwise_180&quot;);</span>
        }
        else{
<span class="fc" id="L184">            return(&quot;path3&quot;);</span>
        }
    }
    /**
     * Initializes and creates the game map by processing the provided map data.
     * This method populates the game board with grass, shrubs, paths.
     * based on the configuration defined in the provided 2D grid (map).
     */
    public void creatboard(){
<span class="fc bfc" id="L193" title="All 2 branches covered.">        for (int i = 0; i &lt; map.length; i++) {</span>
<span class="fc bfc" id="L194" title="All 2 branches covered.">            for (int j = 0; j &lt; map.length; j++) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">                if(this.map[i][j]=='N'){</span>
<span class="fc" id="L196">                    Grass grass=new Grass(j*32,i*32+40);</span>
<span class="fc" id="L197">                    this.grass.add(grass);</span>
<span class="fc" id="L198">                }</span>
<span class="fc bfc" id="L199" title="All 2 branches covered.">                else if(this.map[i][j]=='S'){</span>
<span class="fc" id="L200">                    Shrub shrub=new  Shrub(j*32,40+i*32);</span>
<span class="fc" id="L201">                    this.shrubs.add(shrub);</span>
<span class="fc" id="L202">                }</span>
<span class="fc bfc" id="L203" title="All 2 branches covered.">                else if(this.map[i][j]=='X'){</span>
<span class="fc" id="L204">                        Path path=new Path(j*32,40+i*32,pathtype(map,i,j));</span>
<span class="fc" id="L205">                        this.path.add(path);</span>
<span class="fc" id="L206">                }</span>
                else{
<span class="fc" id="L208">                    wizard=new Wizard(j*32,40+i*32);</span>
                }
            }
        }
<span class="fc" id="L212">    }</span>
    /**
     * Determines whether the mouse cursor is positioned over a grass area, which allows for
     * the operation of creating a tower on that grass area.
     * @param mouseX The x-coordinate of the mouse cursor.
     * @param mouseY The y-coordinate of the mouse cursor.
     * @return The Grass object if the mouse is over a grass area; otherwise, null.
     */
    public Grass containsgrass(int mouseX, int mouseY) {
<span class="pc bpc" id="L221" title="1 of 2 branches missed.">        for (Grass value : grass) {</span>
<span class="pc bpc" id="L222" title="2 of 4 branches missed.">            if (mouseX &gt;= value.getx() &amp;&amp; mouseX &lt;= value.getx() + value.getWidth() &amp;&amp; mouseY &gt;=</span>
<span class="pc bpc" id="L223" title="2 of 4 branches missed.">                    value.gety() &amp;&amp; mouseY &lt;= value.gety() + value.getHeight()) {</span>
<span class="fc" id="L224">                return value;</span>
            }
<span class="nc" id="L226">        }</span>
<span class="nc" id="L227">        return null;</span>
    }
    /**
     * Determines if the mouse cursor is positioned over a tower, allowing for the operation of updating a tower.
     * If the mouse is over a tower, the selected tower is added to the list of selected towers.
     * @param mouseX The x-coordinate of the mouse cursor.
     * @param mouseY The y-coordinate of the mouse cursor.
     */
    public void containtower(int mouseX, int mouseY) {
<span class="fc" id="L236">        selectedTowers.clear();</span>
<span class="pc bpc" id="L237" title="1 of 2 branches missed.">        if (!towers.isEmpty()) {</span>
<span class="fc bfc" id="L238" title="All 2 branches covered.">            for (int i = 0; i &lt; towers.size(); i++) {</span>
<span class="pc bpc" id="L239" title="1 of 4 branches missed.">                if (mouseX &gt;= towers.get(i).getX() &amp;&amp; mouseX &lt;= towers.get(i).getX() + towers.get(i).getWidth() &amp;&amp;</span>
<span class="pc bpc" id="L240" title="2 of 4 branches missed.">                        mouseY &gt;= towers.get(i).getY() &amp;&amp; mouseY &lt;= towers.get(i).getY() + towers.get(i).getHeight()) {</span>
<span class="fc" id="L241">                    selectedTowers.add(towers.get(i));</span>
                }
            }
        }
<span class="fc" id="L245">    }</span>
    /**
     * Determine if the operation to create a tower has been executed
     */
    public void enablebuild(){
<span class="fc bfc" id="L250" title="All 2 branches covered.">        this.buidenable= !buidenable;</span>
<span class="fc bfc" id="L251" title="All 2 branches covered.">        if(buidenable){</span>
<span class="fc" id="L252">            Clip soundClip = sound.get(&quot;pick&quot;);</span>
<span class="pc bpc" id="L253" title="2 of 4 branches missed.">            if (soundClip != null &amp;&amp; !soundClip.isRunning()) {</span>
<span class="fc" id="L254">                soundClip.setFramePosition(0);</span>
<span class="fc" id="L255">                soundClip.start();</span>
            }
        }
<span class="fc" id="L258">    }</span>
    /**
     * Determine if the operation to update tower speed has been executed
     */
    public void enablespeedlevelup(){
<span class="fc bfc" id="L263" title="All 2 branches covered.">        this.speedlevelupenable= !speedlevelupenable;</span>
<span class="fc bfc" id="L264" title="All 2 branches covered.">        if(speedlevelupenable){</span>
<span class="fc" id="L265">            set.playsound(&quot;pick&quot;);</span>
        }
<span class="fc" id="L267">    }</span>
    /**
     * Determine if the operation to update tower range has been executed
     */
    public void enableRangelevelup() {
<span class="fc bfc" id="L272" title="All 2 branches covered.">        rangelevelupenable = !rangelevelupenable;</span>
<span class="fc bfc" id="L273" title="All 2 branches covered.">        if(rangelevelupenable){</span>
<span class="fc" id="L274">            set.playsound(&quot;pick&quot;);</span>
        }
<span class="fc" id="L276">    }</span>
    /**
     * Determine if the operation to update tower damage has been executed
     */
    public void enableDamagelevelup() {
<span class="fc bfc" id="L281" title="All 2 branches covered.">        damagelevelupenable = !damagelevelupenable;</span>
<span class="fc bfc" id="L282" title="All 2 branches covered.">        if(damagelevelupenable){</span>
<span class="fc" id="L283">            set.playsound(&quot;pick&quot;);</span>
        }
<span class="fc" id="L285">    }</span>
    /**
     * Perform operations such as building and upgrading towers based on mouse input.
     * @param mouseX The x-coordinate of the mouse pointer.
     * @param mouseY The y-coordinate of the mouse pointer.
     */
    public void operate(int mouseX, int mouseY) {
<span class="fc bfc" id="L292" title="All 2 branches covered.">        if (buidenable) {</span>
<span class="pc bpc" id="L293" title="1 of 4 branches missed.">            if(containsgrass(mouseX, mouseY) != null&amp;&amp;containsgrass(mouseX, mouseY).getisbuild() &amp;&amp;</span>
<span class="fc bfc" id="L294" title="All 2 branches covered.">                    (mana.getCurrentmana() - tower_cost &gt; 0)){</span>
<span class="fc" id="L295">                mana.spendmana(tower_cost);</span>
<span class="fc" id="L296">                Tower tower = new Tower(containsgrass(mouseX, mouseY).getx(), containsgrass(mouseX, mouseY).gety(),</span>
                            initial_tower_firing_speed, initial_tower_range, initial_tower_damage,
                            tower_cost, mana, wavemangement,sound);
<span class="fc" id="L299">                towers.add(tower);</span>
<span class="fc" id="L300">                containsgrass(mouseX, mouseY).build();</span>
<span class="fc" id="L301">                set.playsound(&quot;plant&quot;);</span>
<span class="fc" id="L302">            }</span>
            else {
<span class="fc" id="L304">                set.playsound(&quot;failto&quot;);</span>
            }
        }
<span class="fc bfc" id="L307" title="All 2 branches covered.">        for (int i = 0; i &lt; towers.size(); i++) {</span>
<span class="fc" id="L308">            Tower tower = towers.get(i);</span>
<span class="fc bfc" id="L309" title="All 4 branches covered.">            if (rangelevelupenable &amp;&amp; isMouseOverTower(tower, mouseX, mouseY)) {</span>
<span class="fc bfc" id="L310" title="All 2 branches covered.">                if (tower.allowupgraterange()) {</span>
<span class="fc" id="L311">                    tower.range_level_up();</span>
<span class="fc" id="L312">                    set.playsound(&quot;levelup&quot;);</span>
                }
                else{
<span class="fc" id="L315">                    set.playsound(&quot;failto&quot;);</span>
                }
            }
<span class="fc bfc" id="L318" title="All 4 branches covered.">            if (speedlevelupenable &amp;&amp; isMouseOverTower(tower, mouseX, mouseY)) {</span>
<span class="fc bfc" id="L319" title="All 2 branches covered.">                if (tower.allowupgratespeed()) {</span>
<span class="fc" id="L320">                    tower.speed_level_up();</span>
<span class="fc" id="L321">                    set.playsound(&quot;levelup&quot;);</span>
                }
                else{
<span class="fc" id="L324">                    set.playsound(&quot;failto&quot;);</span>
                }
            }

<span class="fc bfc" id="L328" title="All 4 branches covered.">            if (damagelevelupenable &amp;&amp; isMouseOverTower(tower, mouseX, mouseY)) {</span>
<span class="fc bfc" id="L329" title="All 2 branches covered.">                if (tower.allowupgratedamage()) {</span>
<span class="fc" id="L330">                    tower.damage_level_up();</span>
<span class="fc" id="L331">                    System.out.println(&quot;damage level up&quot;);</span>
<span class="fc" id="L332">                    set.playsound(&quot;levelup&quot;);</span>
                }
                else{
<span class="fc" id="L335">                    set.playsound(&quot;failto&quot;);</span>
                }
            }
        }
<span class="fc" id="L339">    }</span>
    /**
     * Check if the mouse pointer is over a tower, enabling tower update operations.
     * @param tower The tower to check.
     * @param mouseX The x-coordinate of the mouse pointer.
     * @param mouseY The y-coordinate of the mouse pointer.
     * @return {@code true} if the mouse pointer is over the tower, {@code false} otherwise.
     */
    private boolean isMouseOverTower(Tower tower, int mouseX, int mouseY) {
<span class="fc" id="L348">        int towerX = tower.getX();</span>
<span class="fc" id="L349">        int towerY = tower.getY();</span>
<span class="fc" id="L350">        int towerWidth = tower.getWidth();</span>
<span class="fc" id="L351">        int towerHeight = tower.getHeight();</span>
<span class="pc bpc" id="L352" title="3 of 8 branches missed.">        return mouseX &gt;= towerX &amp;&amp; mouseX &lt;= towerX + towerWidth &amp;&amp; mouseY &gt;= towerY &amp;&amp; mouseY &lt;= towerY + towerHeight;</span>
    }
    /**
     * Get the list of shrubs on the board.
     * @return An ArrayList of Shrub objects.
     */
    public ArrayList&lt;Shrub&gt; getShrubs(){
<span class="fc" id="L359">        return  shrubs;</span>
    }
    /**
     * Get the list of grass on the board.
     * @return An ArrayList of Grass objects.
     */
    public ArrayList&lt;Grass&gt; getGrass(){
<span class="fc" id="L366">        return  grass;</span>
    }
    /**
     * Get the list of paths on the board.
     * @return An ArrayList of Path objects.
     */
    public ArrayList&lt;Path&gt; getPath(){
<span class="fc" id="L373">        return  path;</span>
    }
    /**
     * Get the wizard character on the board.
     * @return The Wizard object.
     */
    public Wizard getWizard(){
<span class="fc" id="L380">        return wizard;</span>
    }
    /**
     * Get the list of selected towers for updates.
     * @return An ArrayList of Tower objects.
     */
<span class="fc" id="L386">    public ArrayList&lt;Tower&gt; getselectedTowers(){return selectedTowers;}</span>
    /**
     * Get the list of towers on the board.
     * @return An ArrayList of Tower objects.
     */
<span class="fc" id="L391">    public ArrayList&lt;Tower&gt; getTowers(){return towers;}</span>
    /**
     * Check if the operation to build towers is enabled.
     * @return {@code true} if tower building is enabled, {@code false} otherwise.
     */
<span class="fc" id="L396">    public boolean getbuildenable(){return buidenable;}</span>
    /**
     * Check if the operation to upgrade tower speed is enabled.
     * @return {@code true} if tower speed upgrading is enabled, {@code false} otherwise.
     */
<span class="fc" id="L401">    public boolean getspeedlevelupenable(){return speedlevelupenable;}</span>
    /**
     * Check if the operation to upgrade tower range is enabled.
     * @return {@code true} if tower range upgrading is enabled, {@code false} otherwise.
     */
<span class="fc" id="L406">    public boolean getRangelevelupenable(){return  rangelevelupenable;}</span>
    /**
     * Check if the operation to upgrade tower damage is enabled.
     * @return {@code true} if tower damage upgrading is enabled, {@code false} otherwise.
     */
<span class="fc" id="L411">    public boolean getDamagelevelupenable(){return damagelevelupenable;}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.9.202303310957</span></div></body></html>